<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> nicolabs | An email domain for your family </title> <meta name="description" content=" Work in progress... "> <meta name="keywords" content="android, development, java, javascript, python, web"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="nicobo"> <meta property="article:section" content=""> <meta property="article:tag" content=""> <meta property="article:published_time" content="2023-06-23 00:00:00 +0200"> <meta property="og:url" content="https://www.nicolabs.net/2023/An-email-domain-for-your-family"> <meta property="og:title" content=" nicolabs | An email domain for your family "> <meta property="og:image" content="https://www.nicolabs.net"> <meta property="og:description" content=" Work in progress... "> <meta property="og:site_name" content="nicobo"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="nic0b0"> <meta name="twitter:title" content=" nicolabs | An email domain for your family "> <meta name="twitter:description" content=" Work in progress... "> <meta name="twitter:image:src" content="https://www.nicolabs.net"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" nicolabs | An email domain for your family "> <meta itemprop="description" content=" Work in progress... "> <meta itemprop="image" content="https://www.nicolabs.net"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="https://www.nicolabs.net/2023/An-email-domain-for-your-family"> <link type="application/atom+xml" rel="alternate" href="https://www.nicolabs.net/feed.xml" title="nicolabs" /> <script type="text/javascript"> var disqus_shortname = 'nicolabs'; </script> <!-- Enable displaying pictures in full size using the Fullscreen API --> <!-- A polyfill that also simplifies the API. TODO maybe there are others closer to the norm and with more features. Still chances are this will not work on iPhone without using a full-fledged Js library. --> <script src="/assets/lib/screenfull.js/dist/screenfull.min.js"></script> <!-- This code selects which elements and how fullscreen is triggered --> <script> document.addEventListener("DOMContentLoaded", function(event) { var els = document.getElementsByClassName("plantuml"); for ( var e=0 ; e<els.length ; e++ ) { var el = els[e]; el.addEventListener('click', function() { if (screenfull.isEnabled) { screenfull.toggle(el); el.classList.toggle("fullscreen"); } else { console.log("Fullscreen not supported"); } }); } }); </script> <script> window.onscroll = function() { if (document.body.scrollTop > 0 || document.documentElement.scrollTop > 0) { document.querySelector('.site-header').classList.add('site-header-pinned'); } else { document.querySelector('.site-header').classList.remove('site-header-pinned'); } }; </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">nico<span>labs</span></a></h1> <ul class="navbar"> <li><a href="/about">about</a></li> <li><a href="/articles">articles</a></li> <li><a href="/feed.xml">feed</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">An email domain for your family</h1> <p class="post-meta"> <a href="https://github.com/nicolabs/nicolabs.github.io/commits/master/_posts/2023-06-23-An-email-domain-for-your-family.md" title="Read full history of this post"> <time class="datePublished" datetime="2023-06-23T00:00:00+02:00" itemprop="datePublished">Jun 23, 2023</time> <span class="post-meta-separator">•</span> <time class="dateModified" datetime="2024-02-14T00:00:00+01:00" itemprop="dateModified">Updated on Feb 14, 2024</time> </a> <span class="post-meta-separator">•</span> <span itemprop="read_time"> 7 minutes read </span> <span class="post-meta-separator">•</span> <span itemprop="maturity"><a href="/2016/Migrating-from-Drupal-to-Jekyll" title="Maturity of this article : draft < good < stable or deprecated&#xa;Click for the explanation.">Maturity : <span class="maturity-label maturity-stable" title="Maturity of this article : draft < good < stable or deprecated">stable</span> </span></a> </p> </header> <div class="post-content" itemprop="articleBody"> <p>Do you want your <em>tribe</em> to share the same <em>cool</em> email addresses suffix like <strong>@smith.org</strong>, <strong>@smith.family</strong>, <strong>@thesmithes.club</strong>… ?</p> <p>You have several choices : <!--more--></p> <p><strong>1. Pay an email provider to host all email accounts.</strong> This forces everyone to use the same provider and may become expensive if your pals are many or require lots of storage… You may get it “free of charge” but you will have to pay by giving up your personal data.</p> <p><img class="plantuml" id="e577fc42d35c3ed221796c679264f932" alt="PlantUML diagram" src="/assets/uml/e577fc42d35c3ed221796c679264f932.svg" /></p> <p><strong>2. Self-host an email server.</strong> This implies a lot of technical maintenance (because you want it to be highly available). Nowadays aggressive anti-spam features of the major email providers also make it very VERY complicated for self-hosting.</p> <p><img class="plantuml" id="d378de7292c39d261459005b376c7a4b" alt="PlantUML diagram" src="/assets/uml/d378de7292c39d261459005b376c7a4b.svg" /></p> <p><strong>3. Let everyone choose their own email provider and redirect to/from the tribe’s domain.</strong></p> <p><img class="plantuml" id="ee5fba42c3117eb066c5457610319abb" alt="PlantUML diagram" src="/assets/uml/ee5fba42c3117eb066c5457610319abb.svg" /></p> <p><strong>This article is a very draft description on how to do it the 3rd way.</strong></p> <blockquote> <p><em>Disclaimer :</em> The providers in this article are just examples. I am not saying that you should use them.</p> </blockquote> <h2 id="the-pattern">The pattern</h2> <p>Let’s say you chose <em>Gandi</em> as a front domain and email provider for your family (or friends) to share the same email domain : <em>thelma@smith.org</em>, <em>tim@smith.org</em>, <em>tom@smith.org</em>, …</p> <p>There are two things to consider :</p> <p><strong>In order for them to receive emails</strong> at their custom <code class="language-plaintext highlighter-rouge">@smith.org</code> address, we need to :</p> <ol> <li>Make the <a href="https://www.cloudflare.com/learning/dns/dns-records/dns-mx-record/">MX records</a> of <code class="language-plaintext highlighter-rouge">smith.org</code> domain point at <em>Gandi’s</em><sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> email servers</li> <li>Configure redirection rules at <em>Gandi’s</em> email servers for each tribe member ; e.g. <code class="language-plaintext highlighter-rouge">tim@smith.org --&gt; tim@gmail.com</code></li> </ol> <p><strong>For them to be able to send emails</strong> from their custom <code class="language-plaintext highlighter-rouge">@smith.org</code> address, we also need to :</p> <ol> <li>Configure new ‘identities’ in each member’s account at their current email provider to use the custom email address</li> <li>Configure anti-spam DNS records at <em>Gandi</em> so that each member can send emails from their own provider’s domain without being blocked</li> </ol> <p>Details for each step are explained in the following paragraphs.</p> <h2 id="choose-an-email-provider-that-can-forward">Choose an email provider that can forward</h2> <p>So you need an email server to forward emails received at <em>@smith.org</em> to each members’ personal mailbox.</p> <p>In this tutorial we don’t want to host the email server ourselves, so you should choose any email provider offering a <em>forwarding</em> service to external email addresses (I guess they all provide it). It may be the one of your personal mailbox or a totally different one. Often the domain registrar itself will offer this already so you probably don’t need to look further.</p> <p><strong>For each family member you will need to add a forward rule</strong> ; e.g. :</p> <table> <thead> <tr> <th>From</th> <th>To</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">tim@smith.org</code></td> <td><code class="language-plaintext highlighter-rouge">tim@gmail.com</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">thelma@smith.org</code></td> <td><code class="language-plaintext highlighter-rouge">thelma455678@iamaboomer.com</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">tom@smith.org</code></td> <td><code class="language-plaintext highlighter-rouge">snoopy@snoopymail.waf</code></td> </tr> </tbody> </table> <p>See the mail provider for the exact procedure (if you’re using the domain registrar’s to do this, <a href="https://docs.gandi.net/en/gandimail/forwarding_and_aliases/index.html">you probably just have to find the correct tab…</a>).</p> <h2 id="register-and-configure-the-family-domain">Register and configure the family domain</h2> <p>There are at least two things to configure on the domain side :</p> <ul> <li>Set <em>MX records</em> pointing at the <em>forwarding</em> email server you chose.</li> <li>Set anti-spam records (<a href="https://www.cloudflare.com/learning/dns/dns-records/dns-spf-record/">a.k.a. “SPF”</a>) to allow other email providers to send upon the family addresses without being flagged as spammers</li> </ul> <h3 id="mx-records-">MX records :</h3> <p><strong>See the mail provider’s documentation for the values to put in the MX records</strong>. Basically, it consists of putting the email server address. If your third-party email provider is also the domain registrar, then maybe it is already configured or there is a one-click procedure.</p> <p>E.g. (beware of then ending dot !) : <code class="language-plaintext highlighter-rouge">example.org. 3600 MX 10 mailserver1.example.org.</code></p> <p>Once MX records and forward rules are configured, you will start receiving emails to the <code class="language-plaintext highlighter-rouge">@smith.org</code> address.</p> <p><br /> <strong>That’s all about <em>receiving</em> emails.</strong></p> <h3 id="spf-records-">SPF records :</h3> <p><strong>To pass through spam filters sending emails from this domain, you will have to set anti-spam records on the DNS</strong> : this is called <a href="https://www.cloudflare.com/learning/dns/dns-records/dns-spf-record/">SPF (Sender Policy Framework)</a>.</p> <p>The principle is straightforward : this is a <a href="https://www.cloudflare.com/learning/dns/dns-records/dns-txt-record/">TXT record</a> on the <code class="language-plaintext highlighter-rouge">smith.org</code> domain which contains the email providers allowed to send emails with this domain. For instance if some members use Gmail and others Yahoo Mail, you need to include both <code class="language-plaintext highlighter-rouge">_spf.google.com</code> and <code class="language-plaintext highlighter-rouge">_spf.mail.yahoo.com</code> to this list (exact values are provided by each mail provider).</p> <p>However if you include too many of them you will reach the <strong>limit of 10 total DNS queries allowed</strong> by the SPF specification !</p> <p><strong>In addition <a href="https://toolbox.googleapps.com/apps/checkmx/">each initial domain may resolve to several ones</a></strong> : for instance <code class="language-plaintext highlighter-rouge">_spf.google.com</code> currently resolves to 3 other domains (3 additional DNS queries). Since your family members probably use different email providers, you may quickly reach the limit…</p> <p>The only way to bypass this limitation is to directly include the IP addresses instead of domain names, as IP addresses don’t trigger a domain name resolution. <strong>In this case you have to take care of updating them if they change</strong> (choice of the provider, not you..). This is called <a href="https://smalltechstack.com/blog/flattening-your-spf-record"><strong>SPF flattening</strong></a>.</p> <p>You <a href="https://dmarcly.com/blog/spf-permerror-too-many-dns-lookups-when-spf-record-exceeds-10-dns-lookup-limit">might find online tools</a> to do this, as well as other tools to update by hand or automatically… As I haven’t found nice &amp; working ones <a href="https://github.com/nicolabs/gandi-spf-flatten/tree/main">I have made one</a>.</p> <p><br /> <strong>Alright. This was the touchy part, other steps are usually straightforward…</strong></p> <h2 id="steps-for-each-family-member">Steps for each family member</h2> <h3 id="allow-their-account-to-send-e-mails-with-their-family-address">Allow their account to send e-mails with their family address</h3> <p>In order to <em>send</em> emails with their family address, members need to configure their account at their own email provider : the procedure differs for one to another but it often simply implies activating the feature and sending a verification email to the new address <a href="https://support.google.com/mail/answer/22370">e.g. for Gmail</a>.</p> <h3 id="add-a-new-identity-in-their-e-mail-apps">Add a new identity in their e-mail apps</h3> <p>As a final step, each member will probably want to add their family address as a new identity so that they don’t need to manually change the <code class="language-plaintext highlighter-rouge">from:</code> field for each message to send.</p> <p>This is also app-specific configuration (e.g. for <a href="https://docs.k9mail.app/en/6.400/settings/account/#manage-identities">K9-Mail</a> ; for <a href="https://support.mozilla.org/en-US/kb/using-identities">Thunderbird</a>).</p> <hr /> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1"> <p>In this example Gandi has both roles : DNS &amp; email provider <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p> </li> </ol> </div> <aside class="tags"> <ul class="tags"> <li class="tag"><a href="/tags#mail">#mail</a></li> <li class="tag"><a href="/tags#self-hosting">#self hosting</a></li> <li class="tag"><a href="/tags#domain">#domain</a></li> </ul> </aside> <!--aside class="share"> <strong>Share this :</strong> <a href="http://twitter.com/share?text=An email domain for your family&amp;url=https://www.nicolabs.net/2023/An-email-domain-for-your-family&amp;hashtags=web,dev,blog,soudev&amp;via=nic0b0" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.nicolabs.net/2023/An-email-domain-for-your-family" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </aside--> </div> </article> <footer class="site-footer"> <div class="container"> <small class="pull-left">&copy;2024 All rights reserved. Graphic banner from https://showyourstripes.info</small> <small class="pull-right">by <a rel="me" href="/about#contact">@nicobo</a></small> </div> </footer> </main> </body> </html>
