<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="shortcut icon" type="image/png" href="/assets/about/favicon.ico"> <title> nicolabs | A nice multi-factor setup for SSH </title> <meta name="description" content=" Work in progress... "> <meta name="keywords" content="android, development, java, javascript, python, web"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="nicobo"> <meta property="article:section" content=""> <meta property="article:tag" content=""> <meta property="article:published_time" content="2022-12-22 00:00:00 +0100"> <meta property="og:url" content="http://*:4000/2022/nice-MFA-setup-for-SSH"> <meta property="og:title" content=" nicolabs | A nice multi-factor setup for SSH "> <meta property="og:image" content="http://*:4000"> <meta property="og:description" content=" Work in progress... "> <meta property="og:site_name" content="nicobo"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" nicolabs | A nice multi-factor setup for SSH "> <meta name="twitter:description" content=" Work in progress... "> <meta name="twitter:image:src" content="http://*:4000"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" nicolabs | A nice multi-factor setup for SSH "> <meta itemprop="description" content=" Work in progress... "> <meta itemprop="image" content="http://*:4000"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/cactus.css" type="text/css"> <link rel="stylesheet" href="/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://*:4000/2022/nice-MFA-setup-for-SSH"> <link type="application/atom+xml" rel="alternate" href="http://*:4000/feed.xml" title="nicolabs" /> <script type="text/javascript" src="/assets/lib/cactus.js"></script> <!-- Enable displaying pictures in full size using the Fullscreen API --> <!-- A polyfill that also simplifies the API. TODO maybe there are others closer to the norm and with more features. Still chances are this will not work on iPhone without using a full-fledged Js library. --> <script src="/assets/lib/screenfull.js/dist/screenfull.min.js"></script> <!-- This code selects which elements and how fullscreen is triggered --> <script> document.addEventListener("DOMContentLoaded", function(event) { var els = document.getElementsByClassName("plantuml"); for ( var e=0 ; e<els.length ; e++ ) { var el = els[e]; el.addEventListener('click', function() { if (screenfull.isEnabled) { screenfull.toggle(el); el.classList.toggle("fullscreen"); } else { console.log("Fullscreen not supported"); } }); } }); </script> <script> window.onscroll = function() { if (document.body.scrollTop > 0 || document.documentElement.scrollTop > 0) { document.querySelector('.site-header').classList.add('site-header-pinned'); } else { document.querySelector('.site-header').classList.remove('site-header-pinned'); } }; </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">nico<span>labs</span></a></h1> <ul class="navbar"> <li><a href="/about">about</a></li> <li><a href="/articles">articles</a></li> <li><a href="/feed.xml">feed</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">A nice multi-factor setup for SSH</h1> <p class="post-meta"> <a href="https://github.com/nicolabs/nicolabs.github.io/commits/master/_posts/2022-12-22-nice-MFA-setup-for-SSH.md" title="Read full history of this post"> <time class="datePublished" datetime="2022-12-22T00:00:00+01:00" itemprop="datePublished">Dec 22, 2022</time> </a> <span class="post-meta-separator">•</span> <span itemprop="read_time"> 15 minutes read </span> <span class="post-meta-separator">•</span> <span itemprop="maturity"><a href="/2016/Migrating-from-Drupal-to-Jekyll" title="Maturity of this article : draft < good < stable or deprecated&#xa;Click for the explanation.">Maturity : <span class="maturity-label maturity-good" title="Maturity of this article : draft < good < stable or deprecated">good</span> </span></a> </p> </header> <div class="post-content" itemprop="articleBody"> <p><img src="/assets/blog/3rdparty/pictures/solokeys.png" alt="SoloKeys" /></p> <figcaption>Illustration © 2022 SOLOKEYS - https://solokeys.com</figcaption> <p>This article shows how to set up an SSH server so that users can authenticate :</p> <ol> <li>either with a hardware token (FIDO-compatible actually)</li> <li>or with a two-factor authentication (2FA) process, using their password and a one-time password (OTP)</li> <li>from the intranet, with a standard SSH key</li> </ol> <!--more--> <p><img class="plantuml" id="a9c25247fe82234d611a9ce56a05b526" alt="PlantUML diagram" src="/assets/uml/a9c25247fe82234d611a9ce56a05b526.svg" /></p> <p>In order to do that, we will see how to :</p> <ul> <li>set up SSH for TOTP (with a PAM module)</li> <li>generate an OTP secret and “pair” with the user’s OTP application</li> <li>set up SSH for FIDO authentication</li> <li>set up the hardware token (I’m using a <a href="https://yubikey.me/">YubiKey</a> here)</li> <li>generate a FIDO key on the hardware token and “pair” with the server</li> </ul> <blockquote> <p><strong><em>Note</em></strong></p> <p>This setup is only an example but should be a good starting point to build and tune your own authentication workflow.</p> </blockquote> <h2 id="lets-start-with-otp-setup-">Let’s start with OTP setup !</h2> <p><img src="https://upload.wikimedia.org/wikipedia/commons/0/03/Security_token.jpg" alt="TOTP hardware token" class="inline" /></p> <h3 id="server-host-setup">Server host setup</h3> <p>In order for a “One-Time Password” (OTP) to be asked for after the usual password, we have to install a <a href="https://en.wikipedia.org/wiki/Linux_PAM">PAM module (Pluggable Authentication Module)</a> on the server side. The module is <a href="https://github.com/google/google-authenticator-libpam">google-authenticator-libpam</a> : it’s from Google but it works with any TOTP-or-HOTP-compatible generator application.</p> <p>Please note that this is not SSH-specific, the module will work for all authentications on this machine.</p> <p>First install the module :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>libpam-google-authenticator
</code></pre></div></div> <p>And enable it by editing PAM configuration ; here a sample <code class="language-plaintext highlighter-rouge">/etc/pam.d/common-auth</code> file :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. here are the per-package modules (the "Primary" block)</span>
<span class="c"># pam_unix is the standard password authentication</span>
<span class="c"># success=1 means to bypass one step (here pam_ldap.so) straight to the OTP module</span>
auth    <span class="o">[</span><span class="nv">success</span><span class="o">=</span>1 <span class="nv">default</span><span class="o">=</span>ignore]      pam_unix.so nullok_secure
<span class="c"># In this sample setup, we allow users to connect with their LDAP password</span>
<span class="c"># success=ok means to go to the next step (which is the OTP module)</span>
auth    <span class="o">[</span><span class="nv">success</span><span class="o">=</span>ok <span class="nv">default</span><span class="o">=</span>ignore]     pam_ldap.so <span class="nv">minimum_uid</span><span class="o">=</span>1000 use_first_pass
<span class="c"># Finally, the OTP password is asked</span>
<span class="c"># In case of success the 'deny' step is bypassed, leading to the 'permit' module</span>
auth    <span class="o">[</span><span class="nv">success</span><span class="o">=</span>1 <span class="nv">default</span><span class="o">=</span>ignore]      pam_google_authenticator.so

<span class="c"># 2. here's the fallback if no module succeeds</span>
auth    requisite                       pam_deny.so

<span class="c"># 3. prime the stack with a positive return value if there isn't one already;</span>
<span class="c"># this avoids us returning an error just because nothing sets a success code</span>
<span class="c"># since the modules above will each just jump around</span>
auth    required                        pam_permit.so
</code></pre></div></div> <p><strong>From here, each user must generate a secret on the server in order to log in !</strong> <strong>So, DO NOT LOG OUT now or generate an OTP secret for yourself (see below) and test the authentication before !</strong></p> <p>There are other possible layouts for the PAM configuration, like <code class="language-plaintext highlighter-rouge">nullok</code> to allow users to log in without OTP until they have set it up : <a href="https://github.com/google/google-authenticator-libpam">github.com/…/google-authenticator-libpam</a>.</p> <p>For this PAM configuration to work with SSH you will have to enable the corresponding authentication method in <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code> :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Allows OTP authentication</span>
KbdInteractiveAuthentication <span class="nb">yes</span>
<span class="c">#ChallengeResponseAuthentication is a deprecated alias for KbdInteractiveAuthentication</span>
<span class="c">#ChallengeResponseAuthentication yes</span>

<span class="c"># Actually enables it</span>
AuthenticationMethods keyboard-interactive
</code></pre></div></div> <p>And restart the SSH server :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>sshd <span class="nt">-t</span> <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>service ssh restart
</code></pre></div></div> <h3 id="per-user-setup">Per-user setup</h3> <p>To connect using OTP, each user must have a <code class="language-plaintext highlighter-rouge">~/.google_authenticator</code> file on the server, with the OTP secret and configuration. Running the following console-interactive process on the server will create this file and print informations to import the secret into an OTP application (e.g. via a QRCode) :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Runs a console-interactive process</span>
google-authenticator
</code></pre></div></div> <p>You may need <a href="https://www.linode.com/docs/guides/secure-ssh-access-with-2fa/#generate-a-key">some help</a> to get the right answers.</p> <p>Once generated, the secret file can be copied to other hosts in order to reuse the same OTP entry (of course you have to make sure users are not blocked by OTP until they can upload their secret) :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Once done, send the file to other hosts where you want to use</span>
<span class="c"># the same OTP secret (e.g. same network servers)</span>
scp ~/.google_authenticator me@anotherhost.intranet
<span class="c"># This should not be necessary, but might help if the file was manually crafted</span>
ssh me@anotherhost.intranet <span class="s1">'chmod 0600 ~/.google_authenticator'</span>
</code></pre></div></div> <p>Some good open source OTP apps for Android and iOS :</p> <ul> <li><img src="https://getaegis.app/images/icon.png" alt="Aegis logo" class="inline" height="32px" /> <a href="https://getaegis.app/">Aegis</a></li> <li><img src="https://freeotp.github.io/img/freeotp.svg" alt="FreeOTP logo" class="inline" height="32px" /> <a href="https://freeotp.github.io/">FreeOTP</a></li> </ul> <p>A successful connection with OTP will look like this :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ssh me@somehost.intranet
<span class="o">(</span>me@somehost.intranet<span class="o">)</span> Password:
<span class="o">(</span>me@somehost.intranet<span class="o">)</span> Verification code:
You have new mail.
me@somehost.intranet:~<span class="err">$</span>
</code></pre></div></div> <h2 id="now-lets-add-authentication-with-a-hardware-token">Now let’s add authentication with a hardware token</h2> <p><img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.nitrokey.com%2Fsites%2Fall%2Fthemes%2Fnitrokey%2Fmedia%2Fnitrokey-u2f.jpg&amp;f=1&amp;nofb=1&amp;ipt=4ceb7b4ae8bf482c619f9428b5ca9679676b065c92c82f765df867bb54975994&amp;ipo=images" alt="Nitrokey" class="inline" height="120px" /><img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fcdn.shopify.com%2Fs%2Ffiles%2F1%2F0196%2F3068%2F6272%2Fproducts%2Fsomu_580x.jpg%3Fv%3D1618577369&amp;f=1&amp;nofb=1&amp;ipt=8876f1516c3911fe122bbf20ebf9f0b28e3671427634f29bb3c2a3756155459e&amp;ipo=images" alt="SoloKeys somu" class="inline" height="120px" /><img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fcdn.shopify.com%2Fs%2Ffiles%2F1%2F2670%2F1700%2Fproducts%2F1_Main_Image_530x%402x.jpg%3Fv%3D1550701254&amp;f=1&amp;nofb=1&amp;ipt=17adad9edf2b1ee0fcf30b4889c643cf3858204b15972710d8dfd86106edeb4a&amp;ipo=images" alt="OnlyKey" class="inline" height="120px" /></p> <p>Since OpenSSH 8.2 it is possible to authenticate with a <a href="https://fidoalliance.org/fido2/">FIDO</a> device, which brings support for a whole lot of hardware tokens.</p> <blockquote> <p><strong><em>Note</em></strong></p> <p>Before 8.2, there were procedures like using a specific <a href="https://www.linode.com/docs/guides/how-to-use-yubikey-for-two-factor-ssh-authentication/">yubico-pam module for YubiKeys</a> (not described here).</p> </blockquote> <p>The process is the same as with <em>public key</em> authentication but with a specific type of key, and you need your hardware token to be plugged in at authentication time.</p> <h3 id="client-setup">Client setup</h3> <h4 id="set-a-pin-on-the-fido2-token">Set a PIN on the FIDO2 token</h4> <p>In order to use a <em>resident key</em> (see below) on a FIDO2 device, you will probably be required to set a PIN.</p> <blockquote> <p><strong><em>Note</em></strong></p> <p>Instructions in this paragraph are specific for YubiKey because it’s the one I had for my tests but the rest of the article should work seamlessly with any other FIDO2 devices (<a href="https://solokeys.com/">SoloKeys</a>, <a href="https://www.nitrokey.com/fr">Nitrokey</a>, <a href="https://onlykey.io/">OnlyKey</a>, … ) which may additionally bring interesting features like full open source design, reversible USB-A, firmware upgrades, hardware password manager, …</p> </blockquote> <p>For a YubiKey, you will need to <a href="https://support.yubico.com/hc/en-us/articles/360016649039-Enabling-the-Yubico-PPA-on-Ubuntu">install the <em>YubiKey Manager (ykman)</em></a>. You will <em>not</em> need the <em>YubiKey Personalization Tool</em> for this tutorial, if you wonder.</p> <p>If you’ve never set up a PIN on your YubiKey, simply run :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Sample OS-independent installation command</span>
pip <span class="nb">install</span> <span class="nt">--user</span> yubikey-manager
<span class="c"># Set the PIN for the first time</span>
ykman fido access change-pin <span class="nt">--new-pin</span> tfbZxxGY3r
</code></pre></div></div> <p>It’s important to note that the PIN is not limited to digits, FIDO2 allows up to <strong>63 alphanumeric characters</strong> !</p> <h4 id="generate-an-ssh-key">Generate an SSH key</h4> <p>Each user must then generate a compatible private key ; run this on a client workstation (choose between option a or b) :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># (option a) Generates a 'resident' key on the token so that it can be used on other computers</span>
<span class="c"># Replace 'NameYourKeyHere' with some string to identify this key</span>
<span class="c"># from others on the hardware token (e.g. 'intranet')</span>
ssh-keygen <span class="nt">-t</span> ed25519-sk <span class="nt">-O</span> resident <span class="nt">-O</span> <span class="nv">application</span><span class="o">=</span>ssh:NameYourKeyHere <span class="nt">-O</span> verify-required <span class="nt">-f</span> ~/.ssh/ed25519_sk_yubikey1

<span class="c"># OR (option b) Generates a key that will only be usable from this computer</span>
ssh-keygen <span class="nt">-t</span> ed25519-sk <span class="nt">-f</span> ~/.ssh/ed25519_sk_yubikey1

<span class="c"># Authorize it to the remote machines</span>
<span class="c"># I've observed that you may need to force with '-f' if you already have keys there</span>
ssh-copy-id <span class="nt">-i</span> ~/.ssh/ed25519_sk_yubikey1.pub me@somehost.intranet
ssh-copy-id <span class="nt">-i</span> ~/.ssh/ed25519_sk_yubikey1.pub me@anotherhost.intranet
</code></pre></div></div> <p>You could use <code class="language-plaintext highlighter-rouge">-t ecdsa-sk</code> key type instead. From what I understand, <code class="language-plaintext highlighter-rouge">ecdsa-sk</code> is more compatible ; <code class="language-plaintext highlighter-rouge">ed25519-sk</code> is <a href="https://www.hyperelliptic.org/tanja/vortraege/20130531.pdf">not affiliated with NIST</a>.</p> <p>The <code class="language-plaintext highlighter-rouge">-O resident</code> parameter (<em>option a</em>) puts all key material on the hardware token, meaning that you will be able to use it from another computer (<code class="language-plaintext highlighter-rouge">ssh-keygen -K</code> will extract some <em>key handle</em> from the token into <code class="language-plaintext highlighter-rouge">~/.ssh/</code> on the local machine). In this case, <code class="language-plaintext highlighter-rouge">-O verify-required</code> is also used so that a PIN is required. <strong>This is only available for FIDO2 devices.</strong></p> <p>On the contrary, the alternative (<em>option b</em>) command will require a private key to be present on the computer <em>in addition</em> to the hardware token, meaning that another person will not be able to log in from another computer even she finds/steals the hardware token. <strong>This works with older FIDO devices.</strong></p> <p>More explanations in the <a href="https://www.openssh.com/txt/release-8.2">release notes of OpenSSH</a>.</p> <p>It is a good practice to repeat all those steps with another security token, so you are not locked-out in case you loose one, but you might also use the OTP process to recover.</p> <h4 id="setting-up-the-ssh-client">Setting up the SSH client</h4> <p>Finally, users should make sure that their SSH client configuration is ready to use their FIDO keys. Here is a partial <code class="language-plaintext highlighter-rouge">~/.ssh/config</code> <em>(more infos in <a href="https://man.openbsd.org/ssh_config">the man page</a>)</em> :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Makes sure public key authentication is enabled</span>
PubkeyAuthentication <span class="nb">yes</span>
<span class="c"># In some weird configurations you might also want to check that</span>
<span class="c"># PreferredAuthentications includes publickey</span>

<span class="c"># Specify my keys for all hosts of the intranet (example)</span>
Host <span class="k">*</span>.intranet
  IdentityFile ~/.ssh/id_rsa
  IdentityFile ~/.ssh/ed25519_sk_yubikey1
  IdentityFile ~/.ssh/ed25519_sk_yubikey2
</code></pre></div></div> <p>Client is ready !</p> <h3 id="ssh-server-setup">SSH server setup</h3> <p>Now, the server part.</p> <p>First make sure your server runs OpenSSH ≥ <a href="https://www.openssh.com/txt/release-8.2">8.2/8.2p1</a>. With older Debian systems <a href="https://forums.raspberrypi.com/viewtopic.php?t=265211#p1817379">you can get it from backports</a>.</p> <p>Then check <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code> (some parts are common with OTP above) <em>(more infos in <a href="https://man.openbsd.org/sshd_config">the man page</a>)</em> :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Public key authentication is used for keys on FIDO devices</span>
PubkeyAuthentication <span class="nb">yes</span>

<span class="c"># Actually enables it (we also keep keyboard-interactive for OTP)</span>
AuthenticationMethods publickey keyboard-interactive

<span class="c"># Makes sure to allow enough tries for users who have many keys</span>
<span class="c"># otherwise, they may encounter a 'Too many authentication failures' error</span>
<span class="c"># even before their FIDO key is tried...</span>
MaxAuthTries 9

<span class="c"># We also enable classic publickey authentication from the local network,</span>
<span class="c"># so connecting from there does not require a password nor a security token.</span>
<span class="c">#</span>
<span class="c"># Because 'PubkeyAuthentication' enables or disables both classic and FIDO keys</span>
<span class="c"># at the same time, we use 'PubkeyAcceptedKeyTypes' to limit key types to FIDO</span>
<span class="c"># by default. Because of the negative matches ('!'), this is applied only if</span>
<span class="c"># it does NOT match a local network address.</span>
<span class="c">#</span>
<span class="c"># Beware that this may not work as expected if connections to the SSH server</span>
<span class="c"># go through a (reverse) proxy or router which does not correctly relay the original client IP !</span>
Match Address <span class="s2">"!10.0.0.0/8,!172.16.0.0/12,!192.168.0.0/16,!fe80::%eth0/10,*"</span>
    PubkeyAcceptedKeyTypes sk-ssh-ed25519@openssh.com,sk-ssh-ed25519-cert-v01@openssh.com,sk-ecdsa-sha2-nistp256@openssh.com,sk-ecdsa-sha2-nistp256-cert-v01@openssh.com
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">Match Address</code> block is to allow normal public key authentication <strong>from the local network only</strong> ; read the comments carefully.</p> <p>Now restart the SSH server :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>sshd <span class="nt">-t</span> <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>service ssh restart
</code></pre></div></div> <p><strong>From another session</strong>, try to authenticate :</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ssh somehost.intranet
<span class="c"># The following message may be different or even absent (your token might be flashing) !</span>
<span class="c"># See https://developers.yubico.com/SSH/Securing_SSH_with_FIDO2.html#_troubleshooting</span>
Confirm user presence <span class="k">for </span>key ssh:NameYourKeyHere
<span class="c"># Then, touch your FIDO2 token</span>
You have new mail.
me@somehost.intranet:~<span class="err">$</span>
</code></pre></div></div> <p>You’re in !</p> <h2 id="bugs-and-limitations">Bugs and limitations</h2> <h3 id="agent-refused-operation">Agent refused operation</h3> <p>When your hardware token is not plugged in, you might have the following message :</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sign_and_send_pubkey: signing failed for ED25519-SK "/home/me/.ssh/ed25519_sk_yubikey1" from agent: agent refused operation
</code></pre></div></div> <p>This is not blocking and SSH will use another method to authenticate (another ssh key or OTP).</p> <h3 id="non-interactive-logins">Non-interactive logins</h3> <p>OTP and FIDO2 “touch” method are suited for interactive login, but you might need to keep SSH public key authentication open for background services (e.g. mounting remote filesystems via SFTP).</p> <p>In this case finer tuning is possible by targeting specific users in the SSH configuration.</p> <h2 id="references">References</h2> <ul> <li>Tutorials : <ul> <li><a href="https://www.youtube.com/watch?v=4lPvjON4-k8">Using YubiKey to Secure Remote Servers in 10 minutes or less | Nextcloud 2FA</a> (video)</li> <li><a href="https://xosc.org/u2fandssh.html">Using a U2F/FIDO key with OpenSSH</a></li> <li><a href="https://developers.yubico.com/SSH/Securing_SSH_with_FIDO2.html">Securing SSH with FIDO2 @ yubico.com</a></li> </ul> </li> <li>Tutorials on OTP + SSH : <ul> <li><a href="https://www.linode.com/docs/guides/secure-ssh-access-with-2fa/">Use 2FA (Two-Factor Authentication) with SSH</a></li> <li><a href="https://www.hallam.ch/blog/index.php/2020/04/19/ssh-sftp-with-two-factor-authentication/">SSH/SFTP with Two Factor Authentication @ hallam.ch</a></li> </ul> </li> <li>YubiKey : <ul> <li><a href="https://support.yubico.com/hc/en-us/articles/4402836718866-Understanding-YubiKey-PINs">Understanding YubiKey PINs</a></li> <li><a href="https://www.yubico.com/support/download/yubikey-manager/">YubiKey Manager downloads for all OS</a></li> <li><a href="https://docs.yubico.com/software/yubikey/tools/ykman/FIDO_Commands.html">YubiKey Manager (ykman) CLI and GUI Guide &gt; FIDO Commands</a></li> <li>Legacy method with <em>pam_yubico</em> : <ul> <li><a href="https://developers.yubico.com/yubico-pam/Two_Factor_PAM_Configuration.html">Two Factor PAM Configuration</a></li> <li><a href="https://www.linode.com/docs/guides/how-to-use-yubikey-for-two-factor-ssh-authentication/">Using a YubiKey for 2FA when Logging in over SSH</a> (legacy )</li> </ul> </li> </ul> </li> <li>Linux PAM : <ul> <li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-pam-to-configure-authentication-on-an-ubuntu-12-04-vps">How To Use PAM to Configure Authentication on an Ubuntu 12.04 VPS @ digitalocean.com</a></li> <li><a href="https://linux.die.net/man/5/pam.d">pam.d(5) - Linux man page</a></li> </ul> </li> <li>More links : <ul> <li><a href="https://forums.raspberrypi.com/viewtopic.php?t=265211">forums.raspberrypi.com &gt; openssh 8.2 enables u2f / fido2 tokens</a></li> <li><a href="http://www.openssh.com/manual.html">OpenSSH manuals</a></li> <li><a href="https://www.hyperelliptic.org/tanja/vortraege/20130531.pdf">Security dangers of the NIST curves</a></li> <li><a href="https://unix.stackexchange.com/a/685221/389700">sshd_config - “Match Address &lt;IPv6&gt;” not matching @ stackexchange</a></li> </ul> </li> </ul> <p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b3/Gemalto_usb_shell_token_with_a_punched_OpenPGP_card_inside.jpg/640px-Gemalto_usb_shell_token_with_a_punched_OpenPGP_card_inside.jpg" alt="Gemalto usb shell token with a punched OpenPGP card inside.jpg" /></p> <aside class="tags"> <ul class="tags"> <li class="tag"><a href="/tags#security">#security</a></li> <li class="tag"><a href="/tags#ssh">#ssh</a></li> <li class="tag"><a href="/tags#mfa">#mfa</a></li> <li class="tag"><a href="/tags#2fa">#2fa</a></li> <li class="tag"><a href="/tags#fido">#fido</a></li> <li class="tag"><a href="/tags#yubikey">#yubikey</a></li> </ul> </aside> <!--aside class="share"> <strong>Share this :</strong> <a href="http://twitter.com/share?text=A nice multi-factor setup for SSH&amp;url=http://*:4000/2022/nice-MFA-setup-for-SSH&amp;hashtags=web,dev,blog,soudev&amp;via=" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://*:4000/2022/nice-MFA-setup-for-SSH" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </aside--> </div> </article> <div id="comment-section"></div> <script> initComments({ node: document.getElementById("comment-section"), defaultHomeserverUrl: "https://matrix.cactus.chat:8448", serverName: "cactus.chat", /* Chat room name will be the concatenation of 'comments_', siteName, '_', commentSectionId. E.g. #comments_nicolabs.net_LineageOS4microg-Upgrade:cactus.chat */ siteName: "nicolabs.net", /* Don't use page.url as slashes are not supported : https://gitlab.com/cactus-comments/cactus-client/-/issues/62 */ commentSectionId: "nice-MFA-setup-for-SSH" }) </script> <noscript>Please enable JavaScript to view the <a href="https://cactus.chat" rel="nofollow">comments powered by matrix.org.</a></noscript> <footer class="site-footer"> <div class="container"> <small class="pull-right">by <a rel="me" href="/about#contact">@nicobo</a></small> </div> </footer> </main> </body> </html>
