<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="shortcut icon" type="image/png" href="/assets/about/favicon.ico"> <title> nicolabs | Un retour d&#39;expérience sur les traces applicatives </title> <meta name="description" content=" Work in progress... "> <meta name="keywords" content="android, development, java, javascript, python, web"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="nicobo"> <meta property="article:section" content=""> <meta property="article:tag" content=""> <meta property="article:published_time" content="2013-03-07 14:03:41 +0100"> <meta property="og:url" content="http://*:4000/2013/An-experience-of-logging"> <meta property="og:title" content=" nicolabs | Un retour d&#39;expérience sur les traces applicatives "> <meta property="og:image" content="http://*:4000"> <meta property="og:description" content=" Work in progress... "> <meta property="og:site_name" content="nicobo"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" nicolabs | Un retour d&#39;expérience sur les traces applicatives "> <meta name="twitter:description" content=" Work in progress... "> <meta name="twitter:image:src" content="http://*:4000"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" nicolabs | Un retour d&#39;expérience sur les traces applicatives "> <meta itemprop="description" content=" Work in progress... "> <meta itemprop="image" content="http://*:4000"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/cactus.css" type="text/css"> <link rel="stylesheet" href="/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://*:4000/2013/An-experience-of-logging"> <link type="application/atom+xml" rel="alternate" href="http://*:4000/feed.xml" title="nicolabs" /> <script type="text/javascript" src="/assets/lib/cactus.js"></script> <!-- Enable displaying pictures in full size using the Fullscreen API --> <!-- A polyfill that also simplifies the API. TODO maybe there are others closer to the norm and with more features. Still chances are this will not work on iPhone without using a full-fledged Js library. --> <script src="/assets/lib/screenfull.js/dist/screenfull.min.js"></script> <!-- This code selects which elements and how fullscreen is triggered --> <script> document.addEventListener("DOMContentLoaded", function(event) { var els = document.getElementsByClassName("plantuml"); for ( var e=0 ; e<els.length ; e++ ) { var el = els[e]; el.addEventListener('click', function() { if (screenfull.isEnabled) { screenfull.toggle(el); el.classList.toggle("fullscreen"); } else { console.log("Fullscreen not supported"); } }); } }); </script> <script> window.onscroll = function() { if (document.body.scrollTop > 0 || document.documentElement.scrollTop > 0) { document.querySelector('.site-header').classList.add('site-header-pinned'); } else { document.querySelector('.site-header').classList.remove('site-header-pinned'); } }; </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">nico<span>labs</span></a></h1> <ul class="navbar"> <li><a href="/about">about</a></li> <li><a href="/articles">articles</a></li> <li><a href="/feed.xml">feed</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Un retour d'expérience sur les traces applicatives</h1> <p class="post-meta"> <a href="https://github.com/nicolabs/nicolabs.github.io/commits/master/_drafts/fr/An-experience-of-logging.md" title="Read full history of this post"> <time class="datePublished" datetime="2013-03-07T14:03:41+01:00" itemprop="datePublished">Mar 7, 2013</time> </a> <span class="post-meta-separator">•</span> <span itemprop="read_time"> 6 minutes read </span> <span class="post-meta-separator">•</span> <span itemprop="maturity"><a href="/2016/Migrating-from-Drupal-to-Jekyll" title="Maturity of this article : draft < good < stable or deprecated&#xa;Click for the explanation.">Maturity : <span class="maturity-label maturity-unpublished" title="Maturity of this article : draft < good < stable or deprecated">unpublished</span> </span></a> </p> </header> <div class="post-content" itemprop="articleBody"> <h2 id="draft-">Draft !</h2> <h1 id="sémantiquement">Sémantiquement</h1> <p>Événements destinés au développeur ou à l’exploitant.</p> <p>Habituellement les évènements sont des “messages”, composés de méta données (ex. En tête) et de champs de données. Une ligne de log contient également des méta données (timestamp, niveau de verbosité, nom du logger, …) Et généralement un seul champ : le contenu que le développeur a écrit).</p> <p>On pourrait donc utiliser la même API ou le même framework pour tout type d’événement, y compris des logs.</p> <p>Toutefois en termes de mise en place il est plus simple/direct d’implémenter des logs qu’un système d’événements, les 2 ont donc leur place.</p> <p>Il manque peu pour pouvoir uniformiser les 2 :</p> <ul> <li>API suffisamment fluide pour les différents types d’événements (méthodes/fonctions adaptées)</li> <li>API assez puissante pour ne pas restreindre les usages actuels (ex. Topics/tags pour les évènements, niveaux de verbosité pour les logs*)</li> <li>performances non pénalisées par un mode (traces et envois asynchrones)</li> <li> <p>connecteurs pour différents types de récolte (fichiers locaux, serveur distant, …)</p> </li> <li> <p>On peut donc imaginer profiter de tags dans les logs pour pouvoir les filtrer facilement (les marqueurs slf4j ne sont pas simples à utiliser) ou d’un niveau de verbosité pour les évènements (ex. Disposer de plus ou moins d’informations sur un parcours client)</p> </li> <li>Niveaux de log</li> </ul> <p>trace je suis passé par là trop verbeuses</p> <p>debug infos précises jusqu’en intégration à activer en cas de problème à résoudre (même en prod)</p> <p>info trace qui fait partie du contrat de service de l’objet émetteur (ex: pour exploitation normale des traces)</p> <p>warning erreur détectée, on continue mais à corriger ! Attention : si c’est une possibilité prévue par le contrat de service, pas warning ni info, mais plutôt debug (car sinon la trace risque de polluer les logs alors que c’est légitime) exemple à donner (JSF ? / SLF4J)</p> <p>error erreur détectée ; service dégradé ou impossible</p> <p>fatal erreurs inattendues try/catch(Exception) au plus haut niveau (point d’entrée du service) -&gt; mail/alerte à la cellule de gestion des incidents (le service n’a pas pu être rendu) -&gt; ajouter dans la trace l’action / la requête / les données à l’origine de l’erreur, car en production, les niveaux inférieurs (debug, …) qui contiennent ces infos risquent d’être filtrés</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ex: pour les servlet, override http://docs.oracle.com/javaee/6/api/javax/servlet/Servlet.html#service%28javax.servlet.ServletRequest,%20javax.servlet.ServletResponse%29 avec juste un try contenant un appel au parent et un catch(Exception) le lancement de l'alerte
init et destroy éventuellement
=&gt; mais attention, toutes ces méthodes retournent un statut d'erreur à l'appelant, on est donc capable de détecter les erreurs (sauf s'il s'agit d'un prestataire externe qui ne nous remonte pas ces erreurs)
L'avantage de #service est qu'il englobe doGet, doPost, ...
</code></pre></div></div> <ul> <li>niveau de confidentialité</li> </ul> <p>un logger par niveau de confidentialité ? -&gt; peu être suffisant la plupart du temps : confidentiel / pas confidentiel</p> <p>Cela implique de récupérer le logger sécurisé lorsqu’une donnée l’est.</p> <p>Ce logger possède lui aussi tous les niveaux de log (trace -&gt; fatal).</p> <ul> <li> <p>selon le niveau de confidentialité certains infos peuvent être tracées mais masquées =&gt; utilitaire pour remplacer les mots de passe par xxxx</p> </li> <li> <p>“Self control”</p> </li> </ul> <p>à l’initialisation : vérifier sa propre configuration et la tracer (+ confidentialité)</p> <p>à la demande : ex: une servlet/JSP dédiée qui va accéder à tous les composants et vérifier leur état courant</p> <p>le meilleur endroit pour faire les vérifications est dans l’objet lui-même (ou dans une sous-classe), car c’est lui qui connait son fonctionnement interne et ses parties importantes</p> <p>pb scope (ex: servlet n’est accessible que depuis le scope request =&gt; on doit l’appeler pour l’instancier et qu’elle puisse vérifier son état)</p> <p>bien faire la différence entre debug et surveillance</p> <p>attention à la sécurité : effet backdoor / injection de code / … =&gt; pas nécessaire de retourner des infos dans le corps de la réponse, on peut juste provoquer des logs dans un fichier particulier (mais attention à l’exploitabilité par des robots de surveillance)</p> <p>ne pas oublier la méthode HTTP HEAD, qui est déjà pensée pour ce rôle (mais permet seulement de tester qu’une URL répond bien -&gt; ne teste pas de manière aussi complète qu’un “inner test”)</p> <p>ex. d’URL : /maservlet?check=status =&gt; vérifie la configuration et affiche/trace un rapport /maservlet?check=error =&gt; simule une erreur (pour vérifier les mécanismes de surveillance)</p> <p>=&gt; nécessite un token d’activation pour ne pas spammer, ou plus simple : un filtrage par adresse IP, une vérification de certificat client (mais ça complique le code) Un simple token partagé et non diffusé peut faire l’affaire !</p> <aside class="tags"> <ul class="tags"> <li class="tag"><a href="/tags#java">#java</a></li> <li class="tag"><a href="/tags#logging">#logging</a></li> <li class="tag"><a href="/tags#monitoring">#monitoring</a></li> <li class="tag"><a href="/tags#security">#security</a></li> <li class="tag"><a href="/tags#testing">#testing</a></li> </ul> </aside> <!--aside class="share"> <strong>Share this :</strong> <a href="http://twitter.com/share?text=Un retour d'expérience sur les traces applicatives&amp;url=http://*:4000/2013/An-experience-of-logging&amp;hashtags=web,dev,blog,soudev&amp;via=" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://*:4000/2013/An-experience-of-logging" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </aside--> </div> </article> <div id="comment-section"></div> <script> initComments({ node: document.getElementById("comment-section"), defaultHomeserverUrl: "https://matrix.cactus.chat:8448", serverName: "cactus.chat", /* Chat room name will be the concatenation of 'comments_', siteName, '_', commentSectionId. E.g. #comments_nicolabs.net_LineageOS4microg-Upgrade:cactus.chat */ siteName: "nicolabs.net", /* Don't use page.url as slashes are not supported : https://gitlab.com/cactus-comments/cactus-client/-/issues/62 */ commentSectionId: "An-experience-of-logging" }) </script> <noscript>Please enable JavaScript to view the <a href="https://cactus.chat" rel="nofollow">comments powered by matrix.org.</a></noscript> <footer class="site-footer"> <div class="container"> <small class="pull-right">by <a rel="me" href="/about#contact">@nicobo</a></small> </div> </footer> </main> </body> </html>
