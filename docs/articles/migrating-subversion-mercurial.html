<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> nicolabs | Migrating from Subversion to Mercurial </title> <meta name="description" content=" Work in progress... "> <meta name="keywords" content="android, development, java, javascript, python, web"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="nicobo"> <meta property="article:section" content=""> <meta property="article:tag" content=""> <meta property="article:published_time" content="2012-01-25 22:25:10 +0100"> <meta property="og:url" content="https://www.nicolabs.net/articles/migrating-subversion-mercurial"> <meta property="og:title" content=" nicolabs | Migrating from Subversion to Mercurial "> <meta property="og:image" content="https://www.nicolabs.net"> <meta property="og:description" content=" Work in progress... "> <meta property="og:site_name" content="nicobo"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="nic0b0"> <meta name="twitter:title" content=" nicolabs | Migrating from Subversion to Mercurial "> <meta name="twitter:description" content=" Work in progress... "> <meta name="twitter:image:src" content="https://www.nicolabs.net"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" nicolabs | Migrating from Subversion to Mercurial "> <meta itemprop="description" content=" Work in progress... "> <meta itemprop="image" content="https://www.nicolabs.net"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="https://www.nicolabs.net/articles/migrating-subversion-mercurial"> <link type="application/atom+xml" rel="alternate" href="https://www.nicolabs.net/feed.xml" title="nicolabs" /> <script type="text/javascript"> var disqus_shortname = 'nicolabs'; </script> <!-- Enable displaying pictures in full size using the Fullscreen API --> <!-- A polyfill that also simplifies the API. TODO maybe there are others closer to the norm and with more features. Still chances are this will not work on iPhone without using a full-fledged Js library. --> <script src="/assets/lib/screenfull.js/dist/screenfull.min.js"></script> <!-- This code selects which elements and how fullscreen is triggered --> <script> document.addEventListener("DOMContentLoaded", function(event) { var els = document.getElementsByClassName("plantuml"); for ( var e=0 ; e<els.length ; e++ ) { var el = els[e]; el.addEventListener('click', function() { if (screenfull.isEnabled) { screenfull.toggle(el); el.classList.toggle("fullscreen"); } else { console.log("Fullscreen not supported"); } }); } }); </script> <script> window.onscroll = function() { if (document.body.scrollTop > 0 || document.documentElement.scrollTop > 0) { document.querySelector('.site-header').classList.add('site-header-pinned'); } else { document.querySelector('.site-header').classList.remove('site-header-pinned'); } }; </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">nico<span>labs</span></a></h1> <ul class="navbar"> <li><a href="/about">about</a></li> <li><a href="/tags">articles</a></li> <li><a href="/feed.xml">feed</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Migrating from Subversion to Mercurial</h1> <p class="post-meta"> <a href="https://github.com/nicolabs/nicolabs.github.io/commits/master/_posts/2012-01-25-Migrating-from-Subversion-to-Mercurial.md" title="Read full history of this post"> <time class="datePublished" datetime="2012-01-25T22:25:10+01:00" itemprop="datePublished">Jan 25, 2012</time> </a> <span class="post-meta-separator">•</span> <span itemprop="read_time"> 3 minutes read </span> <span class="post-meta-separator">•</span> <span itemprop="maturity"><a href="/2016/Migrating-from-Drupal-to-Jekyll" title="Maturity of this article : draft < good < stable or deprecated&#xa;Click for the explanation.">Maturity : <span class="maturity-label maturity-stable" title="Maturity of this article : draft < good < stable or deprecated">stable</span> </span></a> </p> </header> <div class="post-content" itemprop="articleBody"> <blockquote> <p>Instructions are aimed at Windows mainly (on Linux it should be easier).</p> </blockquote> <h2 id="need-to-migrate-from-subversion-to-mercurial-">Need to migrate from Subversion to Mercurial ?</h2> <p>This is a quick guide to migrating an existing <em>SVN</em> repository to a new <em>Hg</em> one.</p> <p>It takes 2 major steps :</p> <ol> <li>make a local copy of the existing SVN repository</li> <li>convert it to Hg</li> </ol> <h3 id="make-a-local-copy-of-the-existing-svn-repository">Make a local copy of the existing SVN repository</h3> <p>Oddly enough, this was the hardest part to figure out :</p> <p><strong>1. Create a local repository</strong></p> <p>It will mirror the existing (remote) one. I just used TortoiseSVN on an new, empty directory.</p> <p><strong>2. Initialize this repository</strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\nicolas\Work&gt;"C:\Program Files\TortoiseSVN\bin\svnsync.exe" init file:///c:/Users/nicolas/Work/ciform-bak https://plugnauth.svn.sourceforge.net/svnroot/plugnauth
</code></pre></div></div> <p>On Windows you will need the following <code class="language-plaintext highlighter-rouge">pre-revprop-change.bat</code> file in the <code class="language-plaintext highlighter-rouge">hooks</code> subdirectory of your newly created repository :</p> <div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">@REM pre-revprop-change.bat</span>
@ECHO <span class="kd">OFF</span>

<span class="kd">set</span> <span class="kd">user</span><span class="o">=</span><span class="err">%</span><span class="m">3</span>

<span class="k">if</span> <span class="na">/I </span><span class="s1">'</span><span class="nv">%user%</span><span class="s1">'</span><span class="o">==</span><span class="s1">'syncuser'</span> <span class="k">goto</span> <span class="kd">ERROR_REV</span>

<span class="k">exit</span> <span class="m">0</span>

<span class="nl">:ERROR</span>_REV <span class="nb">echo</span> <span class="s2">"Only the syncuser user may change revision properties"</span> <span class="o">&gt;&amp;</span><span class="m">2</span>
<span class="k">exit</span> <span class="m">1</span>
</code></pre></div></div> <p><a href="https://gist.github.com/1679659">gist.github.com/1679659</a></p> <p>You may find similar code on the net but :</p> <ul> <li>the sample that’s provided with <em>TortoiseHg</em> (or Tigris’ distribution apparently) only contains Linux-ready scripts</li> <li>many samples on the web work fine for common operations but not for the <code class="language-plaintext highlighter-rouge">svnsync</code> command we are about to use</li> </ul> <p>It looked strange to me that it was not working out of the box on Windows, but I really had to create that script to make it work…</p> <p><strong>3. Start the synchronization</strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\nicolas\Work&gt;"C:\Program Files\TortoiseSVN\bin\svnsync.exe" sync --username cbonar file:///C:/Users/nicolas/Work/ciform-bak
[...]
Committed revision 92.
Copied properties for revision 92.
Transmitting file data .
Committed revision 93.
Copied properties for revision 93.
</code></pre></div></div> <p>We can now work with this local SVN mirror.</p> <h3 id="convert-the-svn-repository-to-a-hg-one">Convert the SVN repository to a Hg one</h3> <p>This operation is quite simple…</p> <p><strong>1. Enable ConvertExtension</strong></p> <p>With a command line client, it should be as easy as making sure you have the following in your <code class="language-plaintext highlighter-rouge">.hgrc</code> or <code class="language-plaintext highlighter-rouge">mercurial.ini</code> file :</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[extensions]
convert=
</code></pre></div></div> <p>With TortoiseHg I just had to enable <code class="language-plaintext highlighter-rouge">convert</code> in the global settings (I did first on the repo settings only but it didn’t work right away so I gave up) :</p> <p><img src="/assets/blog/TortoiseHg-ConvertExtension.png" alt="ConvertExtension enabled in TortoiseHg" /></p> <p><strong>2. Run the “hg convert” command</strong></p> <p>It might be the right time to <a href="http://mercurial.selenic.com/wiki/ConvertExtension#A--authors">remap author names</a>…</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Program Files\TortoiseHg&gt;hg convert file:///c:/Users/nicolas/Work/ciform-bak file:///c:/users/nicolas/Work/ciform-hg
initializing destination file:///c:/users/nicolas/Work/ciform-hg repository
scanning source...
sorting...
converting...
92 + added trunk directory : main development stream
[...]
0 + a lot of work on the ant task
</code></pre></div></div> <p>Done. <strong>You now have a fully functional Mercurial repository with all changesets from the SVN history !</strong></p> <p>Successful import from SourceForge’s SVN to Google Code’s Hg :</p> <p><img src="/assets/blog/svn2hg-googlecode.png" alt="Sample project imported from Sourceforge's SVN to Google code's Hg" /></p> <h2 id="related-links">Related links</h2> <ul> <li>Sample <code class="language-plaintext highlighter-rouge">pre-revprop-change</code> hooks for Windows : <a href="http://stackoverflow.com/questions/6155/common-types-of-subversion-hooks/9010360#9010360">stackoverflow.com/questions/6155/common-types-of-subversion-hooks/9010360#9010360</a></li> <li>Official doc for converting from different sources to Hg : <a href="http://mercurial.selenic.com/wiki/ConvertExtension">mercurial.selenic.com/wiki/ConvertExtension</a></li> <li><code class="language-plaintext highlighter-rouge">pre-revprop-change.bat</code> adapted for Windows from : <a href="http://chestofbooks.com/computers/revision-control/subversion-svn/Repository-Replication-Reposadmin-Maint-Replication.html">chestofbooks.com/computers/revision-control/subversion-svn/Repository-Replication-Reposadmin-Maint-Replication.html</a></li> </ul> <aside class="tags"> <ul class="tags"> <li class="tag"><a href="/tags#mercurial">#mercurial</a></li> <li class="tag"><a href="/tags#subversion">#subversion</a></li> <li class="tag"><a href="/tags#tooling">#tooling</a></li> </ul> </aside> <aside class="share"> <strong>Share this :</strong> <a href="http://twitter.com/share?text=Migrating from Subversion to Mercurial&amp;url=https://www.nicolabs.net/articles/migrating-subversion-mercurial&amp;hashtags=web,dev,blog,soudev&amp;via=nic0b0" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.nicolabs.net/articles/migrating-subversion-mercurial" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </aside> </div> </article> <footer class="site-footer"> <div class="container"> <small class="pull-left">&copy;2022 All rights reserved.</small> <small class="pull-right">by <a rel="me" href="/about#contact">@nicobo</a></small> </div> </footer> </main> </body> </html>
