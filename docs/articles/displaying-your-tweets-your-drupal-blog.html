<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> nicolabs | Displaying your tweets on your Drupal blog </title> <meta name="description" content=" Work in progress... "> <meta name="keywords" content="android, development, java, javascript, python, web"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="nicobo"> <meta property="article:section" content=""> <meta property="article:tag" content=""> <meta property="article:published_time" content="2012-05-06 18:22:47 +0200"> <meta property="og:url" content="http://localhost:4000/articles/displaying-your-tweets-your-drupal-blog"> <meta property="og:title" content=" nicolabs | Displaying your tweets on your Drupal blog "> <meta property="og:image" content="http://localhost:4000"> <meta property="og:description" content=" Work in progress... "> <meta property="og:site_name" content="nicobo"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="nic0b0"> <meta name="twitter:title" content=" nicolabs | Displaying your tweets on your Drupal blog "> <meta name="twitter:description" content=" Work in progress... "> <meta name="twitter:image:src" content="http://localhost:4000"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" nicolabs | Displaying your tweets on your Drupal blog "> <meta itemprop="description" content=" Work in progress... "> <meta itemprop="image" content="http://localhost:4000"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://localhost:4000/articles/displaying-your-tweets-your-drupal-blog"> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="nicolabs" /> <script type="text/javascript"> var disqus_shortname = 'nicolabs'; </script> <!-- Enable displaying pictures in full size using the Fullscreen API --> <!-- A polyfill that also simplifies the API. TODO maybe there are others closer to the norm and with more features. Still chances are this will not work on iPhone without using a full-fledged Js library. --> <script src="/assets/lib/screenfull.js/dist/screenfull.min.js"></script> <!-- This code selects which elements and how fullscreen is triggered --> <script> document.addEventListener("DOMContentLoaded", function(event) { var els = document.getElementsByClassName("plantuml"); for ( var e=0 ; e<els.length ; e++ ) { var el = els[e]; el.addEventListener('click', function() { if (screenfull.isEnabled) { screenfull.toggle(el); el.classList.toggle("fullscreen"); } else { console.log("Fullscreen not supported"); } }); } }); </script> <script> window.onscroll = function() { if (document.body.scrollTop > 0 || document.documentElement.scrollTop > 0) { document.querySelector('.site-header').classList.add('site-header-pinned'); } else { document.querySelector('.site-header').classList.remove('site-header-pinned'); } }; </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">nico<span>labs</span></a></h1> <ul class="navbar"> <li><a href="/about">about</a></li> <li><a href="/articles">articles</a></li> <li><a href="/feed.xml">feed</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Displaying your tweets on your Drupal blog</h1> <p class="post-meta"> <a href="https://github.com/nicolabs/nicolabs.github.io/commits/master/_posts/2012-05-06-Displaying-your-tweets-on-your-Drupal-blog.md" title="Read full history of this post"> <time class="datePublished" datetime="2012-05-06T18:22:47+02:00" itemprop="datePublished">May 6, 2012</time> </a> <span class="post-meta-separator">•</span> <span itemprop="read_time"> 6 minutes read </span> <span class="post-meta-separator">•</span> <span itemprop="maturity"><a href="/2016/Migrating-from-Drupal-to-Jekyll" title="Maturity of this article : draft < good < stable or deprecated&#xa;Click for the explanation.">Maturity : <span class="maturity-label maturity-stable" title="Maturity of this article : draft < good < stable or deprecated">stable</span> </span></a> </p> </header> <div class="post-content" itemprop="articleBody"> <h2 id="twitter-module-for-drupal">Twitter module for Drupal</h2> <p>If you want to display your latest tweets on your Drupal blog, you will probably want to use the dedicated <a href="http://drupal.org/project/twitter">Twitter module</a>. Among other features, this module provides a new block type that lists a selection of tweets from an account. Tweets are retrieved via a cron job and stored in your website’s database, making them available even through corporate firewalls that banish twitter.com. Just-what-you-need !</p> <p>There are a few catches however : it will likely not work if you are on a shared host because <a href="https://dev.twitter.com/docs/rate-limiting">Twitter puts rate limits</a> to the usage of their API, and there is a bug in the block view that can be circumvented.</p> <p>Here are the important steps to configure the module for our needs :</p> <ol> <li>Install <strong>Twitter</strong> module and some dependencies : <strong>OAuth</strong>, <strong>Autoload</strong>, <strong>Views</strong></li> <li>Activate the modules <em>Twitter</em>, <em>OAuth</em>, <em>Autoload</em>, <em>Views</em> and <em>Views UI</em> (the other Twitter modules ‘<em>actions</em>’, ‘<em>post</em>’ and ‘<em>signin</em>’ are not required for our purpose)</li> <li>Setup the Twitter module as described <a href="http://drupal.org/node/1226204">in the documentation</a> : you will need to register your application and fill in OAuth consumer secret and key</li> <li>Associate a Twitter account with your user (this is also described <a href="http://drupal.org/node/1253026">in the documentation</a>). This creates a line in the <code class="language-plaintext highlighter-rouge">twitter_account</code> table and is mandatory for OAuth requests.</li> <li>Start cron to retrieve your tweets. If this step gives you a “rate limit exceeded” message, welcome to the club : go ahead and read the next chapter.</li> <li>Lastly, create the block view that you will include in your layout. You don’t need to follow the documentation : simply clone the twitter view as you wish and <a href="http://drupal.org/node/1253026#comment-5917528">remove the user:uid filter to make it work</a> (looks like a bug). Change the “Admin” field to help you distinguish it from the default twitter block.</li> </ol> <h3 id="use-twitter-api-on-localhost">Use Twitter API on localhost</h3> <p>If you want to register your local site (from your local computer), you can use <code class="language-plaintext highlighter-rouge">http://127.0.0.1/twitter/oauth</code> as the callback URL in step 3.</p> <p>And if your test site does not respond to <code class="language-plaintext highlighter-rouge">127.0.0.1</code> (but for instance to <code class="language-plaintext highlighter-rouge">mysite.localhost</code>), the callback will fail, but you will still get the URL with the right query parameters (e.g. <code class="language-plaintext highlighter-rouge">http://127.0.0.1/twitter/oauth?oauth_token=LbcMx...LcR3d&amp;oauth_verifier=trdf5...aaOjQ</code>) in step 4 : you can then simply change the host in the URL and try it a second time !</p> <h2 id="patching-for-use-on-a-shared-host">Patching for use on a shared host</h2> <p>In order to fetch twitter statuses (your tweets), the Twitter module makes unauthenticated calls to the API by default, and therefore is subject to a <strong><a href="https://dev.twitter.com/docs/rate-limiting#rest">rate limit of 150 requests per hour</a> measured against the IP address</strong> of the server making the request.</p> <p>On shared hosts many sites use the same front IP address and thus the rate limit is reached every hour. In short, the sites trying to use this feature make it impossible to use for any host on the same shared host…!</p> <p>Twitter’s API allows for more requests if you use authenticated calls : up to 350 requests per hour <strong>measured against a token that’s unique to your Twitter account</strong>. This is largely enough for our needs as it does not rely on the IP address.</p> <h3 id="first-option--set-a-field-in-the-database">First option : set a field in the database</h3> <p>To choose whether or not using an authenticated call, the module will look at some point for the value of the field named “protected” attached to the user in Drupal’s database (<code class="language-plaintext highlighter-rouge">twitter_account</code> table). If this field has value that converts to <code class="language-plaintext highlighter-rouge">TRUE</code> in PHP, tweets will be retrieved through authentified calls.</p> <p>You can <a href="http://drupal.org/node/1358308#comment-5644266">set the field value to 1</a> with your preferred database query tool.</p> <p>However, setting this field to <code class="language-plaintext highlighter-rouge">TRUE</code> also allows other users to create tweets on behalf of this account. Furthermore, it may be set back to 0 by some parts of the module we don’t control.</p> <h3 id="second-option--patch-a-line-of-code">Second option : patch a line of code</h3> <p>Looking at the code, it looked to me more adequate to patch the code of the module.</p> <p>Simply look for the file named <code class="language-plaintext highlighter-rouge">twitter.inc</code> in the module’s files, and replace the use of <code class="language-plaintext highlighter-rouge">$account-&gt;protected` with `twitter_use_oauth()</code> in the <code class="language-plaintext highlighter-rouge">$twitter-&gt;user_timeline(...)</code> call of the <code class="language-plaintext highlighter-rouge">twitter_fetch_user_timeline</code> function.</p> <p>There is only one line to change :</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="mf">...</span>
<span class="k">function</span> <span class="n">twitter_fetch_user_timeline</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="mf">...</span>
<span class="c1">//  $statuses = $twitter-&gt;user_timeline($account-&gt;id, $params, $account-&gt;protected);</span>
  <span class="nv">$statuses</span> <span class="o">=</span> <span class="nv">$twitter</span><span class="o">-&gt;</span><span class="nf">user_timeline</span><span class="p">(</span><span class="nv">$account</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span> <span class="nv">$params</span><span class="p">,</span> <span class="nf">_twitter_use_oauth</span><span class="p">());</span>
<span class="mf">...</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p>And here we go : a nice Twitter timeline fetched and displayed on a shared host !</p> <p><img src="/assets/blog/sites_tweets.png" alt="Sample site tweets block" /></p> <h2 id="references">References</h2> <ul> <li>Twitter’s API rate limiting rules : <a href="https://dev.twitter.com/docs/rate-limiting">dev.twitter.com/docs/rate-limiting</a></li> <li>Twitter module for Drupal : <a href="http://drupal.org/project/twitter">drupal.org/project/twitter</a> (there is a link to full documentation on the side menu)</li> <li>Drupal : “Rate limit exceeded” : <a href="http://drupal.org/node/456102">drupal.org/node/456102</a></li> </ul> <aside class="tags"> <ul class="tags"> <li class="tag"><a href="/tags#blogging">#blogging</a></li> <li class="tag"><a href="/tags#drupal">#drupal</a></li> <li class="tag"><a href="/tags#oauth">#oauth</a></li> <li class="tag"><a href="/tags#social">#social</a></li> <li class="tag"><a href="/tags#twitter">#twitter</a></li> <li class="tag"><a href="/tags#web-design">#web design</a></li> </ul> </aside> <aside class="share"> <strong>Share this :</strong> <a href="http://twitter.com/share?text=Displaying your tweets on your Drupal blog&amp;url=http://localhost:4000/articles/displaying-your-tweets-your-drupal-blog&amp;hashtags=web,dev,blog,soudev&amp;via=nic0b0" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/articles/displaying-your-tweets-your-drupal-blog" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </aside> </div> </article> <footer class="site-footer"> <div class="container"> <small class="pull-left">&copy;2022 All rights reserved.</small> <small class="pull-right">by <a rel="me" href="/about#contact">@nicobo</a></small> </div> </footer> </main> </body> </html>
